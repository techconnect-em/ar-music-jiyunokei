<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/v1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
        // マーカー画像のURLと音源ファイルのURLを定義 (後で設定)
        const markerImageURL = 'YOUR_MARKER_IMAGE_URL';
        const audioFileURL = 'YOUR_AUDIO_FILE_URL.mp3';
    </script>
</head>
<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;'>
        <a-marker type='pattern' url='${markerImageURL}'>
            <a-entity
                geometry='primitive: sphere; radius: 0.5;'
                material='color: blue'
                animation__scale='property: scale; to: 1.5 1.5 1.5; dur: 1000; easing: easeOutElastic; startEvents: play'></a-entity>
        </a-marker>
        <a-entity camera></a-entity>
        <audio id="audio" src="${audioFileURL}" preload="auto"></audio>
        <script>
            const audio = document.getElementById('audio');
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const analyser = audioContext.createAnalyser();
            const source = audioContext.createMediaElementSource(audio);
            source.connect(analyser);
            analyser.connect(audioContext.destination);
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            const sphere = document.querySelector('a-sphere');

            AFRAME.registerComponent('audio-visualizer', {
                tick: function () {
                    analyser.getByteFrequencyData(dataArray);
                    let average = 0;
                    for (let i = 0; i < bufferLength; i++) {
                        average += dataArray[i];
                    }
                    average /= bufferLength;
                    const scale = 1 + (average / 50);
                    this.el.setAttribute('scale', `${scale} ${scale} ${scale}`);
                }
            });

            sphere.setAttribute('audio-visualizer', '');

            const marker = document.querySelector('a-marker');
            marker.addEventListener('markerFound', function() {
                audioContext.resume();
                audio.play();
            });
            marker.addEventListener('markerLost', function() {
                audio.pause();
            });
        </script>
    </a-scene>
</body>
</html>
